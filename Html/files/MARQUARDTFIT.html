<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Marquardt_Fit</title>
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
body {
  margin: 5px 5px 5px 5px;
  background-color: #ffffff;
}
/* ========== Text Styles ========== */
hr { color: #000000}
body, table, span.rvts0 /* Font Style */
{
 font-size: 10pt;
 font-family: 'Arial', 'Helvetica', sans-serif;
 font-style: normal;
 font-weight: normal;
 color: #000000;
 text-decoration: none;
}
span.rvts1 /* Heading */
{
 font-weight: bold;
 color: #0000ff;
}
span.rvts2 /* Subheading */
{
 font-weight: bold;
 color: #000080;
}
span.rvts3 /* Keywords */
{
 font-style: italic;
 color: #800000;
}
a.rvts4, span.rvts4 /* Jump 1 */
{
 color: #008000;
 text-decoration: underline;
}
a.rvts5, span.rvts5 /* Jump 2 */
{
 color: #008000;
 text-decoration: underline;
}
span.rvts6 /* Font Hint */
{
 color: #a0a0a0;
}
span.rvts7 /* Font Hint Title */
{
 font-size: 15pt;
 font-family: 'Tahoma', 'Geneva', sans-serif;
 font-weight: bold;
 color: #696969;
}
span.rvts8 /* Font Hint Bold */
{
 font-weight: bold;
 color: #a0a0a0;
}
span.rvts9 /* Font Hint Italic */
{
 font-style: italic;
 color: #a0a0a0;
}
span.rvts10
{
 font-size: 12pt;
 font-weight: bold;
}
span.rvts11
{
 color: #0000ff;
}
span.rvts12
{
 font-weight: bold;
}
span.rvts13
{
 font-size: 12pt;
 font-style: italic;
 font-weight: bold;
}
span.rvts14
{
 font-family: 'Courier New', 'Courier', monospace;
}
span.rvts15
{
 font-family: 'Courier New', 'Courier', monospace;
 font-weight: bold;
}
span.rvts16
{
 font-family: 'Courier New', 'Courier', monospace;
 font-weight: bold;
 color: #008000;
}
span.rvts17
{
 font-weight: bold;
 color: #ff6600;
}
span.rvts18
{
 font-size: 12pt;
 font-style: italic;
}
span.rvts19 /* Font Style */
{
 font-size: 16pt;
 font-family: 'Tahoma', 'Geneva', sans-serif;
 color: #ffffff;
}
span.rvts20 /* Font Style */
{
 font-family: 'MS Sans Serif', 'Geneva', sans-serif;
 color: #808080;
}
/* ========== Para Styles ========== */
p,ul,ol /* Paragraph Style */
{
 text-align: left;
 text-indent: 0px;
 padding: 0px 0px 0px 0px;
 margin: 0px 0px 0px 0px;
}
.rvps1 /* Centered */
{
 text-align: center;
}
.rvps2
{
 margin: 0px 0px 0px 3px;
}
.rvps3
{
 margin: 0px 0px 0px 1px;
}
.rvps4
{
 text-align: justify;
}
.rvps5 /* Paragraph Style */
{
 text-align: left;
 text-indent: 0px;
 background: #0000ff;
 padding: 5px 5px 2px 5px;
 margin: -5px -5px 18px -5px;
}
.rvps6 /* Paragraph Style */
{
 text-align: center;
 background: #e4e4e4;
 margin: 20px 0px 0px 0px;
}
--></style>
<link rel="StyleSheet" href="hnd.css" type="text/css"/>
<script type="text/javascript">if(top.frames.length == 0) { sTopic = top.location.href.substring(top.location.href.lastIndexOf("/") + 1, top.location.href.length); top.location.href="../crysfml.htm?" + sTopic; }</script>
<script type="text/javascript" src="jquery.min.js"></script>
<script type="text/javascript" src="jquery.cookie.js"></script>
<script type="text/javascript" src="hnd.js"></script>
<meta name="generator" content="HelpNDoc Professional Edition"></head>
<body>
<h1 class=rvps5><span class=rvts0><span class=rvts19>CFML_Optimization_LSQ: Subroutines</span></span></h1>
<p><span class=rvts10>Subroutine Marquardt_Fit (Model_Funct, X, Y, W, Yc, NObs, C, VS, Ipr, Chi2, Scroll_Lines )</span></p>
<p><br></p>
<div><table width="100%" border=1 cellpadding=1 cellspacing=2 style="border-width: 0px;">
<tr valign=top>
<td width=242 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts12>Defined Subroutine Model_Funct</span></p>
</td>
<td width=98 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts11><br></span></p>
</td>
<td width=104 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p>Model_Funct</p>
</td>
<td width=410 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p>Name of the subroutine calculating Yc(i) for point X(i)</p>
</td>
</tr>
<tr valign=top>
<td width=242 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Real</span><span class=rvts12>(</span><span class=rvts1>Kind</span><span class=rvts12>=CP)</span><span class=rvts1>, Dimension </span><span class=rvts12>(:)</span></p>
</td>
<td width=98 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Intent</span><span class=rvts12>(</span><span class=rvts1>in</span><span class=rvts12>)</span></p>
</td>
<td width=104 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p>X</p>
</td>
<td width=410 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p>Vector of x-values</p>
</td>
</tr>
<tr valign=top>
<td width=242 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Real</span><span class=rvts12>(</span><span class=rvts1>Kind</span><span class=rvts12>=CP)</span><span class=rvts1>, Dimension </span><span class=rvts12>(:)</span></p>
</td>
<td width=98 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Intent</span><span class=rvts12>(</span><span class=rvts1>in</span><span class=rvts12>)</span></p>
</td>
<td width=104 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p>Y</p>
</td>
<td width=410 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p>Vector of observed y-values</p>
</td>
</tr>
<tr valign=top>
<td width=242 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Real</span><span class=rvts12>(</span><span class=rvts1>Kind</span><span class=rvts12>=CP)</span><span class=rvts1>, Dimension </span><span class=rvts12>(:)</span></p>
</td>
<td width=98 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Intent</span><span class=rvts12>(</span><span class=rvts1>in out</span><span class=rvts12>)</span></p>
</td>
<td width=104 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p>W</p>
</td>
<td width=410 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p>Vector of weights-values (1/variance)</p>
</td>
</tr>
<tr valign=top>
<td width=242 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Real</span><span class=rvts12>(</span><span class=rvts1>Kind</span><span class=rvts12>=CP)</span><span class=rvts1>, Dimension </span><span class=rvts12>(:)</span></p>
</td>
<td width=98 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Intent</span><span class=rvts12>(</span><span class=rvts1>out</span><span class=rvts12>)</span></p>
</td>
<td width=104 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p>Yc</p>
</td>
<td width=410 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p class=rvps3>Vector of calculated y-values</p>
</td>
</tr>
<tr valign=top>
<td width=242 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Integer</span></p>
</td>
<td width=98 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Intent</span><span class=rvts12>(</span><span class=rvts1>in</span><span class=rvts12>)</span></p>
</td>
<td width=104 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p>NObs</p>
</td>
<td width=410 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p class=rvps2>Number of effective components of X, Y, W, YC</p>
</td>
</tr>
<tr valign=top>
<td width=242 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Type </span><span class=rvts12>(LSQ_Conditions_Type)</span></p>
</td>
<td width=98 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Intent</span><span class=rvts12>(</span><span class=rvts1>in out</span><span class=rvts12>)</span></p>
</td>
<td width=104 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p>C</p>
</td>
<td width=410 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p class=rvps2>Conditions for the algorithm</p>
</td>
</tr>
<tr valign=top>
<td width=242 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Type </span><span class=rvts12>(LSQ_State_Vector_Type)</span></p>
</td>
<td width=98 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Intent</span><span class=rvts12>(</span><span class=rvts1>in out</span><span class=rvts12>)</span></p>
</td>
<td width=104 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p>VS</p>
</td>
<td width=410 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p class=rvps2>State vector for the model calculation</p>
</td>
</tr>
<tr valign=top>
<td width=242 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Integer</span></p>
</td>
<td width=98 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Intent</span><span class=rvts12>(</span><span class=rvts1>in</span><span class=rvts12>)</span></p>
</td>
<td width=104 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p>Ipr</p>
</td>
<td width=410 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p class=rvps2>Logical unit for writing</p>
</td>
</tr>
<tr valign=top>
<td width=242 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Real</span><span class=rvts12>(</span><span class=rvts1>Kind</span><span class=rvts12>=CP)</span></p>
</td>
<td width=98 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Intent</span><span class=rvts12>(</span><span class=rvts1>out</span><span class=rvts12>)</span></p>
</td>
<td width=104 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p>Chi2</p>
</td>
<td width=410 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p class=rvps2>Reduced Chi-2</p>
</td>
</tr>
<tr valign=top>
<td width=242 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Character</span><span class=rvts12>(</span><span class=rvts17>Len</span><span class=rvts12>=*)</span><span class=rvts1>, Dimension</span><span class=rvts12>(:)</span><span class=rvts1>, Optional</span></p>
</td>
<td width=98 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Intent</span><span class=rvts12>(</span><span class=rvts1>out</span><span class=rvts12>)</span></p>
</td>
<td width=104 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p>Scroll_Lines</p>
</td>
<td width=410 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p class=rvps2>If present, part of the output is stored in this text for treatment in the calling program</p>
</td>
</tr>
</table>
</div>
<p><br></p>
<p><span class=rvts13>and</span> </p>
<p><br></p>
<p><span class=rvts12>Subroutine Model_Funct (Iv, Xv, Ycalc, Aa, Der)</span></p>
<div><table width="100%" border=0 cellpadding=1 cellspacing=2 style="border-width: 0px;">
<tr valign=top>
<td width=330><p><span class=rvts1>&nbsp;&nbsp; Integer</span></p>
</td>
<td width=98><p><span class=rvts1>Intent</span><span class=rvts12>(</span><span class=rvts1>in</span><span class=rvts12>)</span></p>
</td>
<td width=98><p>Iv</p>
</td>
<td width=369><p>Number of the component "i"</p>
</td>
</tr>
<tr valign=top>
<td width=330><p><span class=rvts1>&nbsp;&nbsp; Real</span><span class=rvts12>(</span><span class=rvts1>Kind=</span><span class=rvts12>CP)</span></p>
</td>
<td width=98><p><span class=rvts1>Intent</span><span class=rvts12>(</span><span class=rvts1>in</span><span class=rvts12>)</span></p>
</td>
<td width=98><p>Xv</p>
</td>
<td width=369><p>Value of X(i)</p>
</td>
</tr>
<tr valign=top>
<td width=330><p><span class=rvts1>&nbsp;&nbsp; Real</span><span class=rvts12>(</span><span class=rvts1>Kind=</span><span class=rvts12>CP)</span></p>
</td>
<td width=98><p><span class=rvts1>Intent</span><span class=rvts12>(</span><span class=rvts1>out</span><span class=rvts12>)</span></p>
</td>
<td width=98><p>Ycalc</p>
</td>
<td width=369><p>Value of yc at point x(i)</p>
</td>
</tr>
<tr valign=top>
<td width=330><p><span class=rvts1>&nbsp;&nbsp; Real</span><span class=rvts12>(</span><span class=rvts1>Kind=</span><span class=rvts12>CP)</span><span class=rvts1>, Dimension </span><span class=rvts12>(:)</span></p>
</td>
<td width=98><p><span class=rvts1>Intent</span><span class=rvts12>(</span><span class=rvts1>in</span><span class=rvts12>)</span></p>
</td>
<td width=98><p>Aa</p>
</td>
<td width=369><p>Vector of parameters</p>
</td>
</tr>
<tr valign=top>
<td width=330><p><span class=rvts1>&nbsp;&nbsp; Real</span><span class=rvts12>(</span><span class=rvts1>Kind=</span><span class=rvts12>CP)</span><span class=rvts1>, Dimension </span><span class=rvts12>(:), </span><span class=rvts1>Optional</span></p>
</td>
<td width=98><p><span class=rvts1>Intent</span><span class=rvts12>(</span><span class=rvts1>out</span><span class=rvts12>)</span></p>
</td>
<td width=98><p>Der</p>
</td>
<td width=369><p>Derivatives of the function w.r.t. free parameters</p>
</td>
</tr>
</table>
</div>
<p><span class=rvts12>End Subroutine Model_Funct</span></p>
<p><br></p>
<p><br></p>
<p><span class=rvts18>or</span></p>
<p><br></p>
<p><br></p>
<p><span class=rvts10>Subroutine Marquardt_Fit (Model_Funct, D, C, VS, Ipr, Chi2, Scroll_Lines )</span></p>
<p><br></p>
<div><table width="100%" border=1 cellpadding=1 cellspacing=2 style="border-width: 0px;">
<tr valign=top>
<td width=242 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts12>Defined Subroutine Model_Funct</span></p>
</td>
<td width=98 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts11><br></span></p>
</td>
<td width=104 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p>Model_Funct</p>
</td>
<td width=410 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p>Name of the subroutine calculating YC(i) for point X(i)</p>
</td>
</tr>
<tr valign=top>
<td width=242 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Type</span><span class=rvts12>(LSQ_Data_Type)</span></p>
</td>
<td width=98 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Intent</span><span class=rvts12>(</span><span class=rvts1>in out</span><span class=rvts12>)</span></p>
</td>
<td width=104 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p>D</p>
</td>
<td width=410 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p>LSQ Data Type</p>
</td>
</tr>
<tr valign=top>
<td width=242 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Type </span><span class=rvts12>(LSQ_Conditions_Type)</span></p>
</td>
<td width=98 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Intent</span><span class=rvts12>(</span><span class=rvts1>in out</span><span class=rvts12>)</span></p>
</td>
<td width=104 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p>C</p>
</td>
<td width=410 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p class=rvps2>Conditions for the algorithm</p>
</td>
</tr>
<tr valign=top>
<td width=242 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Type </span><span class=rvts12>(LSQ_State_Vector_Type)</span></p>
</td>
<td width=98 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Intent</span><span class=rvts12>(</span><span class=rvts1>in out</span><span class=rvts12>)</span></p>
</td>
<td width=104 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p>VS</p>
</td>
<td width=410 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p class=rvps2>State vector for the model calculation</p>
</td>
</tr>
<tr valign=top>
<td width=242 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Integer</span></p>
</td>
<td width=98 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Intent</span><span class=rvts12>(</span><span class=rvts1>in</span><span class=rvts12>)</span></p>
</td>
<td width=104 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p>Ipr</p>
</td>
<td width=410 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p class=rvps2>Logical unit for writing</p>
</td>
</tr>
<tr valign=top>
<td width=242 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Real</span><span class=rvts12>(</span><span class=rvts1>Kind</span><span class=rvts12>=CP)</span></p>
</td>
<td width=98 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Intent</span><span class=rvts12>(</span><span class=rvts1>out</span><span class=rvts12>)</span></p>
</td>
<td width=104 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p>Chi2</p>
</td>
<td width=410 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p class=rvps2>Reduced Chi-2</p>
</td>
</tr>
<tr valign=top>
<td width=242 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Character</span><span class=rvts12>(</span><span class=rvts17>Len</span><span class=rvts12>=*)</span><span class=rvts1>, Dimension</span><span class=rvts12>(:)</span><span class=rvts1>, Optional</span></p>
</td>
<td width=98 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p><span class=rvts1>Intent</span><span class=rvts12>(</span><span class=rvts1>out</span><span class=rvts12>)</span></p>
</td>
<td width=104 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p>Scroll_Lines</p>
</td>
<td width=410 style="border-width : 1px; border-color : #808080 #ffffff #ffffff #808080; border-style: solid;"><p class=rvps2>If present, part of the output is stored in this text for treatment in the calling program</p>
</td>
</tr>
</table>
</div>
<p><br></p>
<p><span class=rvts13>and</span> </p>
<p><br></p>
<p><span class=rvts12>Subroutine Model_Funct (Iv, Xv, Ycalc, VSA, CalDer)</span></p>
<div><table width="100%" border=0 cellpadding=1 cellspacing=2 style="border-width: 0px;">
<tr valign=top>
<td width=330><p><span class=rvts1>&nbsp;&nbsp; Integer</span></p>
</td>
<td width=98><p><span class=rvts1>Intent</span><span class=rvts12>(</span><span class=rvts1>in</span><span class=rvts12>)</span></p>
</td>
<td width=98><p>Iv</p>
</td>
<td width=369><p>Number of the component "i"</p>
</td>
</tr>
<tr valign=top>
<td width=330><p><span class=rvts1>&nbsp;&nbsp; Real</span><span class=rvts12>(</span><span class=rvts1>Kind=</span><span class=rvts12>CP)</span></p>
</td>
<td width=98><p><span class=rvts1>Intent</span><span class=rvts12>(</span><span class=rvts1>in</span><span class=rvts12>)</span></p>
</td>
<td width=98><p>Xv</p>
</td>
<td width=369><p>Value of X(i)</p>
</td>
</tr>
<tr valign=top>
<td width=330><p><span class=rvts1>&nbsp;&nbsp; Real</span><span class=rvts12>(</span><span class=rvts1>Kind=</span><span class=rvts12>CP)</span></p>
</td>
<td width=98><p><span class=rvts1>Intent</span><span class=rvts12>(</span><span class=rvts1>out</span><span class=rvts12>)</span></p>
</td>
<td width=98><p>Ycalc</p>
</td>
<td width=369><p>Value of yc at point x(i)</p>
</td>
</tr>
<tr valign=top>
<td width=330><p><span class=rvts1>&nbsp;&nbsp; Type </span><span class=rvts12>(LSQ_State_Vector_Type)</span></p>
</td>
<td width=98><p><span class=rvts1>Intent</span><span class=rvts12>(</span><span class=rvts1>in out</span><span class=rvts12>)</span></p>
</td>
<td width=98><p>VSA</p>
</td>
<td width=369><p>LSQ State vector type</p>
</td>
</tr>
<tr valign=top>
<td width=330><p><span class=rvts1>&nbsp;&nbsp; Logical</span><span class=rvts12>, </span><span class=rvts1>Optional</span></p>
</td>
<td width=98><p><span class=rvts1>Intent</span><span class=rvts12>(</span><span class=rvts1>in</span><span class=rvts12>)</span></p>
</td>
<td width=98><p>CalDer</p>
</td>
<td width=369><p>If present, derivatives, stored in Vsa%dpv, are calculated</p>
</td>
</tr>
</table>
</div>
<p><span class=rvts12>End Subroutine Model_Funct</span></p>
<p><br></p>
<p><br></p>
<p>Procedure for applying the Levenberg-Marquardt method for Least-Squares.</p>
<p><br></p>
<p>The user must provide a model function according to the interface above. The model function should use at least some of the public variables of the present module in order to set the derivatives with respect to the model parameters. </p>
<p><br></p>
<p><br></p>
<p>For using this routine, the user must provide:</p>
<p><br></p>
<div><table border=0 cellpadding=1 cellspacing=2 style="border-width: 0px;">
<tr valign=top>
<td width=114><p class=rvps1><span class=rvts13>Parameter</span></p>
</td>
<td width=551><p class=rvps1><span class=rvts13>Description</span></p>
</td>
</tr>
<tr valign=top>
<td width=114><p>C%Icyc</p>
</td>
<td width=551><p class=rvps4>Number of cycles</p>
</td>
</tr>
<tr valign=top>
<td width=114><p>C%Iw</p>
</td>
<td width=551><p class=rvps4>type of weighting scheme</p>
</td>
</tr>
<tr valign=top>
<td width=114><p>C%Constr</p>
</td>
<td width=551><p class=rvps4>constraint conditions</p>
</td>
</tr>
<tr valign=top>
<td width=114><p>C%Percent</p>
</td>
<td width=551><p class=rvps4>constraint conditions</p>
</td>
</tr>
</table>
</div>
<p><br></p>
<p><br></p>
<div><table border=0 cellpadding=1 cellspacing=2 style="border-width: 0px;">
<tr valign=top>
<td width=114><p class=rvps1><span class=rvts13>Parameter</span></p>
</td>
<td width=551><p class=rvps1><span class=rvts13>Description</span></p>
</td>
</tr>
<tr valign=top>
<td width=114><p>VS%NP</p>
</td>
<td width=551><p class=rvps4>number of model parameters</p>
</td>
</tr>
<tr valign=top>
<td width=114><p>VS%NamPar</p>
</td>
<td width=551><p class=rvps4>name for all possible parameters of the model </p>
</td>
</tr>
<tr valign=top>
<td width=114><p>VS%PV</p>
</td>
<td width=551><p class=rvps4>A set of flags values to refine or fix the parameters</p>
</td>
</tr>
</table>
</div>
<p><br></p>
<p> </p>
<p>The values of all possible refinable parameters are stored in the array VS%PV. </p>
<p><br></p>
<p>The derivatives must be calculated within Model_Funct, by using the array VS%Der. The actual refined parameters Aa are selected from the larger VS%PV array by the Integer array of flags: VS%Code. A value VS%CODE(j)=1 means that the j-th parameter is to be varied. A value VS%CODE(k)=0 means that the k-th parameter is kept fixed through the refinement cycles.</p>
<p><br></p>
<p>It is recommended that Model_Funct be stored in a Module. The Integer IV (counter of the loop for all observations for which the subroutine is invoked) is passed because in many cases part of the calculations and derivatives may be calculated only for iv=1 and stored in local variables that should have the SAVE attribute or be private module variables accessible by host association. The only output values of the subroutine are ycalc and Vsa%dpv(:) that vary for each "iv" point. In this version of the algorithm the derivatives with respect to the free parameters in Model_Funct should be calculated before exiting by using the following loop:</p>
<p><br></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=rvts14> </span><span class=rvts15>vs%dpv=0.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts16>!Should be always be initialized for each point</span></p>
<p><span class=rvts15>&nbsp;&nbsp;&nbsp; if (present(calder)) then</span></p>
<p><span class=rvts15>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do i=1,vs%np</span></p>
<p><span class=rvts15>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (vs%code(i) == 0) cycle</span></p>
<p><span class=rvts15>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; vs%dpv(i) = derivative_wrt(i) </span><span class=rvts16>!symbolic form for calculating the derivative w.r.t. parameter "i"</span></p>
<p><span class=rvts15>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end do&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts16>!at the current point xv (observation "iv")</span></p>
<p><span class=rvts15>&nbsp;&nbsp;&nbsp; end if</span></p>
<p><br></p>
<p><br></p>
<p class=rvps6><span class=rvts20>Copyleft © 2011, FullProf Suite Team</span></p>
</body></html>
