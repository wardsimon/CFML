<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>MARQUARDT_FIT</title>
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
body {
  margin: 5px 5px 5px 5px;
  background-color: #ffffff;
}
/* ========== Text Styles ========== */
hr { color: #000000}
body, table /* Font Style */
{
 font-size: 10pt;
 font-family: 'Arial', 'Helvetica', sans-serif;
 font-style: normal;
 font-weight: normal;
 color: #000000;
 text-decoration: none;
}
span.rvts1 /* Heading */
{
 font-weight: bold;
 color: #0000ff;
}
span.rvts2 /* Subheading */
{
 font-weight: bold;
 color: #000080;
}
span.rvts3 /* Keywords */
{
 font-style: italic;
 color: #800000;
}
a.rvts4, span.rvts4 /* Jump 1 */
{
 color: #008000;
 text-decoration: underline;
}
a.rvts5, span.rvts5 /* Jump 2 */
{
 color: #008000;
 text-decoration: underline;
}
span.rvts6 /* Font Hint */
{
 color: #a0a0a0;
}
span.rvts7 /* Font Hint Title */
{
 font-size: 15pt;
 font-family: 'Tahoma', 'Geneva', sans-serif;
 font-weight: bold;
 color: #696969;
}
span.rvts8 /* Font Hint Bold */
{
 font-weight: bold;
 color: #a0a0a0;
}
span.rvts9 /* Font Hint Italic */
{
 font-style: italic;
 color: #a0a0a0;
}
span.rvts10
{
 font-size: 12pt;
 font-weight: bold;
}
span.rvts11
{
 color: #0000ff;
}
span.rvts12
{
 font-weight: bold;
}
span.rvts13
{
 color: #ff6600;
}
span.rvts14
{
 font-size: 12pt;
 font-style: italic;
 font-weight: bold;
}
span.rvts15 /* Font Style */
{
 font-size: 16pt;
 font-family: 'Tahoma', 'Geneva', sans-serif;
 color: #ffffff;
}
span.rvts16 /* Font Style */
{
 font-family: 'MS Sans Serif', 'Geneva', sans-serif;
 color: #808080;
}
/* ========== Para Styles ========== */
p,ul,ol /* Paragraph Style */
{
 text-align: left;
 text-indent: 0px;
 padding: 0px 0px 0px 0px;
 margin: 0px 0px 0px 0px;
}
.rvps1 /* Centered */
{
 text-align: center;
}
.rvps2
{
 margin: 0px 0px 0px 3px;
}
.rvps3
{
 margin: 0px 0px 0px 1px;
}
.rvps4
{
 text-align: justify;
}
.rvps5 /* Paragraph Style */
{
 background: #0000ff;
 padding: 5px 5px 2px 5px;
 margin: -5px -5px 18px -5px;
}
.rvps6 /* Paragraph Style */
{
 text-align: center;
 background: #e4e4e4;
 margin: 20px 0px 0px 0px;
}
--></style>
<script type="text/javascript">if(top.frames.length == 0) { top.location.href="../crysfml.htm?MARQUARDTFIT.html"; }</script>
<meta name="generator" content="HelpNDoc Professional Edition"></head>
<body>

<p class=rvps5><span class=rvts15>MARQUARDT_FIT</span></p>
<p><span class=rvts10>SUBROUTINE MARQUARDT_FIT(MODEL_FUNCT, X, Y, W, YC, NOBS, C, VS, IPR, CHI2, SCROLL_LINES )</span></p>
<p><br></p>
<div><table width="100%" border=0 cellpadding=1 cellspacing=2 style="border-width: 0px;">
<tr valign=top>
<td width=242>
<p><span class=rvts12>Defined Subroutine Model_Funct</span></p>
</td>
<td width=98>
<p><span class=rvts11><br></span></p>
</td>
<td width=104>
<p>MODEL_FUNCT</p>
</td>
<td width=410>
<p>Name of the subroutine calculating YC(i) for point X(i)</p>
</td>
</tr>
<tr valign=top>
<td width=242>
<p><span class=rvts11>REAL</span>(<span class=rvts11>KIND</span>=CP)<span class=rvts11>, DIMENSION </span>(:)</p>
</td>
<td width=98>
<p><span class=rvts11>INTENT</span>(<span class=rvts11>IN</span>)</p>
</td>
<td width=104>
<p>X</p>
</td>
<td width=410>
<p>Vector of x-values</p>
</td>
</tr>
<tr valign=top>
<td width=242>
<p><span class=rvts11>REAL</span>(<span class=rvts11>KIND</span>=CP)<span class=rvts11>, DIMENSION </span>(:)</p>
</td>
<td width=98>
<p><span class=rvts11>INTENT</span>(<span class=rvts11>IN</span>)</p>
</td>
<td width=104>
<p>Y</p>
</td>
<td width=410>
<p>Vector of observed y-values</p>
</td>
</tr>
<tr valign=top>
<td width=242>
<p><span class=rvts11>REAL</span>(<span class=rvts11>KIND</span>=CP)<span class=rvts11>, DIMENSION </span>(:)</p>
</td>
<td width=98>
<p><span class=rvts11>INTENT</span>(<span class=rvts11>IN OUT</span>)</p>
</td>
<td width=104>
<p>W</p>
</td>
<td width=410>
<p>Vector of weights-values (1/variance)</p>
</td>
</tr>
<tr valign=top>
<td width=242>
<p><span class=rvts11>REAL</span>(<span class=rvts11>KIND</span>=CP)<span class=rvts11>, DIMENSION </span>(:)</p>
</td>
<td width=98>
<p><span class=rvts11>INTENT</span>(<span class=rvts11>OUT</span>)</p>
</td>
<td width=104>
<p>YC</p>
</td>
<td width=410>
<p class=rvps3>Vector of calculated y-values</p>
</td>
</tr>
<tr valign=top>
<td width=242>
<p><span class=rvts11>INTEGER</span></p>
</td>
<td width=98>
<p><span class=rvts11>INTENT</span>(<span class=rvts11>IN</span>)</p>
</td>
<td width=104>
<p>NOBS</p>
</td>
<td width=410>
<p class=rvps2>Number of effective components of X, Y, W, YC</p>
</td>
</tr>
<tr valign=top>
<td width=242>
<p><span class=rvts11>TYPE</span>(LSQ_CONDITIONS_TYPE)</p>
</td>
<td width=98>
<p><span class=rvts11>INTENT</span>(<span class=rvts11>IN OUT</span>)</p>
</td>
<td width=104>
<p>C</p>
</td>
<td width=410>
<p class=rvps2>Conditions for the algorithm</p>
</td>
</tr>
<tr valign=top>
<td width=242>
<p><span class=rvts11>TYPE</span>(LSQ_STATE_VECTOR_TYPE)</p>
</td>
<td width=98>
<p><span class=rvts11>INTENT</span>(<span class=rvts11>IN OUT</span>)</p>
</td>
<td width=104>
<p>VS</p>
</td>
<td width=410>
<p class=rvps2>State vector for the model calculation</p>
</td>
</tr>
<tr valign=top>
<td width=242>
<p><span class=rvts11>INTEGER</span></p>
</td>
<td width=98>
<p><span class=rvts11>INTENT</span>(<span class=rvts11>IN</span>)</p>
</td>
<td width=104>
<p>IPR</p>
</td>
<td width=410>
<p class=rvps2>Logical unit for writing</p>
</td>
</tr>
<tr valign=top>
<td width=242>
<p><span class=rvts11>REAL</span>(<span class=rvts11>KIND</span>=CP)</p>
</td>
<td width=98>
<p><span class=rvts11>INTENT</span>(<span class=rvts11>OUT</span>)</p>
</td>
<td width=104>
<p>CHI2</p>
</td>
<td width=410>
<p class=rvps2>Reduced Chi-2</p>
</td>
</tr>
<tr valign=top>
<td width=242>
<p><span class=rvts11>CHARACTER</span>(<span class=rvts13>LEN</span>=*)<span class=rvts11>, DIMENSION</span>(:)<span class=rvts11>, OPTIONAL</span></p>
</td>
<td width=98>
<p><span class=rvts11>INTENT</span>(<span class=rvts11>OUT</span>)</p>
</td>
<td width=104>
<p>SCROLL_LINES</p>
</td>
<td width=410>
<p class=rvps2>If present, part of the output is stored in this text for treatment in the calling program</p>
</td>
</tr>
</table>
</div>
<p><br></p>
<p><br></p>
<p><span class=rvts12>SUBROUTINE MODEL_FUNCTN (IV, XV, YCALC, AA, DER)</span></p>
<div><table width="100%" border=0 cellpadding=1 cellspacing=2 style="border-width: 0px;">
<tr valign=top>
<td width=330>
<p><span class=rvts11>&nbsp;&nbsp; INTEGER</span></p>
</td>
<td width=98>
<p><span class=rvts11>INTENT</span>(<span class=rvts11>IN</span>)</p>
</td>
<td width=98>
<p>IV</p>
</td>
<td width=369>
<p>Number of the component "i"</p>
</td>
</tr>
<tr valign=top>
<td width=330>
<p><span class=rvts11>&nbsp;&nbsp; REAL</span>(<span class=rvts11>KIND=</span>CP)</p>
</td>
<td width=98>
<p><span class=rvts11>INTENT</span>(<span class=rvts11>IN</span>)</p>
</td>
<td width=98>
<p>XV</p>
</td>
<td width=369>
<p>Value of X(i)</p>
</td>
</tr>
<tr valign=top>
<td width=330>
<p><span class=rvts11>&nbsp;&nbsp; REAL</span>(<span class=rvts11>KIND=</span>CP)</p>
</td>
<td width=98>
<p><span class=rvts11>INTENT</span>(<span class=rvts11>OUT</span>)</p>
</td>
<td width=98>
<p>YCALC</p>
</td>
<td width=369>
<p>Value of yc at point x(i)</p>
</td>
</tr>
<tr valign=top>
<td width=330>
<p><span class=rvts11>&nbsp;&nbsp; REAL</span>(<span class=rvts11>KIND=</span>CP)<span class=rvts11>, DIMENSION </span>(:)</p>
</td>
<td width=98>
<p><span class=rvts11>INTENT</span>(<span class=rvts11>IN</span>)</p>
</td>
<td width=98>
<p>AA</p>
</td>
<td width=369>
<p>Vector of parameters</p>
</td>
</tr>
<tr valign=top>
<td width=330>
<p><span class=rvts11>&nbsp;&nbsp; REAL</span>(<span class=rvts11>KIND=</span>CP)<span class=rvts11>, DIMENSION </span>(:), <span class=rvts11>OPTIONAL</span></p>
</td>
<td width=98>
<p><span class=rvts11>INTENT</span>(<span class=rvts11>OUT</span>)</p>
</td>
<td width=98>
<p>DER</p>
</td>
<td width=369>
<p>Derivatives of the function w.r.t. free parameters</p>
</td>
</tr>
</table>
</div>
<p><span class=rvts12>END SUBROUTINE MODEL_FUNCTN</span></p>
<p><br></p>
<p><br></p>
<p>Procedure for applying the Levenberg-Marquardt method for Least-Squares.</p>
<p><br></p>
<p>The user must provide a model function according to the interface above. The model function should use at least some of the public variables of the present module in order to set the derivatives with respect to the model parameters. </p>
<p><br></p>
<p><br></p>
<p>For using this routine, the user must provide:</p>
<p><br></p>
<div><table border=0 cellpadding=1 cellspacing=2 style="border-width: 0px;">
<tr valign=top>
<td width=114>
<p class=rvps1><span class=rvts14>Parameter</span></p>
</td>
<td width=551>
<p class=rvps1><span class=rvts14>Description</span></p>
</td>
</tr>
<tr valign=top>
<td width=114>
<p>C%ICYC</p>
</td>
<td width=551>
<p class=rvps4>Number of cycles</p>
</td>
</tr>
<tr valign=top>
<td width=114>
<p>C%IW</p>
</td>
<td width=551>
<p class=rvps4>type of weighting scheme</p>
</td>
</tr>
<tr valign=top>
<td width=114>
<p>C%CONSTR</p>
</td>
<td width=551>
<p class=rvps4>constraint conditions</p>
</td>
</tr>
<tr valign=top>
<td width=114>
<p>C%PERCENT</p>
</td>
<td width=551>
<p class=rvps4>constraint conditions</p>
</td>
</tr>
</table>
</div>
<p><br></p>
<p><br></p>
<div><table border=0 cellpadding=1 cellspacing=2 style="border-width: 0px;">
<tr valign=top>
<td width=114>
<p class=rvps1><span class=rvts14>Parameter</span></p>
</td>
<td width=551>
<p class=rvps1><span class=rvts14>Description</span></p>
</td>
</tr>
<tr valign=top>
<td width=114>
<p>VS%NP</p>
</td>
<td width=551>
<p class=rvps4>number of model parameters</p>
</td>
</tr>
<tr valign=top>
<td width=114>
<p>VS%NAMPAR</p>
</td>
<td width=551>
<p class=rvps4>name for all possible parameters of the model </p>
</td>
</tr>
<tr valign=top>
<td width=114>
<p>VS%PV</p>
</td>
<td width=551>
<p class=rvps4>A set of flags values to refine or fix the parameters</p>
</td>
</tr>
</table>
</div>
<p><br></p>
<p> </p>
<p>The values of all possible refinable parameters are stored in the array VS%PV. The derivatives must be calculated within MODEL_FUNCTN, by using the array VS%DER. The actual refined parameters AA are selected from the larger VS%PV array by the integer array of flags: VS%CODE. A value VS%CODE(j)=1 means that the j-th parameter is to be varied. A value VS%CODE(k)=0 means that the k-th parameter is kept fixed through the refinement cycles.</p>
<p><br></p>
<p class=rvps6><span class=rvts16>Copyleft © 2009, FullProf Suite Team</span></p>

</body></html>
